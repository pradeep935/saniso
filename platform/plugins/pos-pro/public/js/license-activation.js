document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("license-activation-form"),t=document.getElementById("deactivate-license-btn"),n=document.getElementById("toggle-purchase-code");if(e&&e.addEventListener("submit",function(t){t.preventDefault();var n=document.getElementById("activate-license-btn"),o=n.querySelector(".spinner-border"),s=new FormData(e);n.disabled=!0,o.classList.remove("d-none"),fetch(e.dataset.action,{method:"POST",body:s,headers:{"X-CSRF-TOKEN":document.querySelector("meta[name=csrf-token]").content,"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){e.error?Botble.showError(e.message):(Botble.showSuccess(e.message),setTimeout(function(){window.location.reload()},1e3))}).catch(function(e){console.error("License activation error:",e),Botble.showError(i("somethingWentWrong"))}).finally(function(){n.disabled=!1,o.classList.add("d-none")})}),t&&t.addEventListener("click",function(){if(confirm(i("deactivateLicenseConfirm"))){var e,t=this;t.disabled=!0;var n=(null===(e=document.querySelector("[data-deactivate-url]"))||void 0===e?void 0:e.dataset.deactivateUrl)||window.location.pathname+"/deactivate";fetch(n,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector("meta[name=csrf-token]").content,"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){e.error?Botble.showError(e.message):(Botble.showSuccess(e.message),setTimeout(function(){window.location.reload()},1e3))}).catch(function(e){console.error("License deactivation error:",e),Botble.showError(i("somethingWentWrong"))}).finally(function(){t.disabled=!1})}}),n&&window.location.pathname.includes("/license")){var o=!1;n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();try{var t=document.getElementById("purchase-code-display"),n=document.getElementById("show-icon"),s=document.getElementById("hide-icon");if(!t||!n||!s)return void console.warn("License toggle elements not found:",{display:!!t,showIcon:!!n,hideIcon:!!s});if(!this.dataset.fullCode||!this.dataset.maskedCode)return void console.warn("License toggle missing data attributes");o?(t.textContent=this.dataset.maskedCode,n&&(n.style.display="inline"),s&&(s.style.display="none"),this.title=i("showPurchaseCode"),o=!1):(t.textContent=this.dataset.fullCode,n&&(n.style.display="none"),s&&(s.style.display="inline"),this.title=i("hidePurchaseCode"),o=!0)}catch(e){console.error("Error in license toggle:",e)}})}function i(e){var t;return(null===(t=window.posTranslations)||void 0===t?void 0:t[e])||e}});